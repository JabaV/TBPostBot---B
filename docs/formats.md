# Форматы данных

Этот документ описывает все используемые форматы конфигурации и данных.

## 1. groups.txt

Поддерживаются два формата — новый и старый. Файл читается построчно; строки, начинающиеся с `# ` (решётка и пробел), игнорируются.

### 1.1 Новый формат

```
groupid:[tags:b1:b2:b3:b4:b5:links:image]|delay
```

- `groupid` (int) — ID сообщества ВК (без минуса).
- Скобки `[...]` содержат 8 сегментов:
  1) `tags` — вариант блока из `files/tags.txt`
  2) `b1` — вариант из `files/block1.txt`
  3) `b2` — вариант из `files/block2.txt`
  4) `b3` — вариант из `files/block3.txt`
  5) `b4` — вариант из `files/block4.txt`
  6) `b5` — вариант из `files/block5.txt`
  7) `links` — вариант из `files/links.txt`
  8) `image` — числовой ID картинки (используется как `photo{bot_id}_{image}`)

- Любой блок (`tags`, `b1..b5`, `links`) может быть:
  - `-` для случайного выбора варианта
  - Идентификатором варианта (см. формат блочных файлов) — например: `1`, `2`, `intro`, `###tajikistan`

- `delay` — задержка перед постингом в формате `1d2h3m4s` (части опциональны, порядок фиксирован: d → h → m → s).
  - Примеры: `3d2h`, `45m`, `1h30m`, `10s`, пусто — дефолт.

Примеры строк:
```
156716828:[-:1:-:###tajikistan:-:-:-:457239113]|3d2h
51153697:[-:-:-:2:-:-:-:457239111]|12h
```

### 1.2 Старый формат

```
groupid:path|image[?seconds]
```

- `path` — путь к текстовому файлу (например, `files/TG.txt`), либо `-` для случайного выбора из `files/text1.txt` … `files/text5.txt`.
- `image` — числовой ID картинки (см. выше).
- Необязательный параметр `?seconds` задаёт задержку в секундах.

Примеры строк:
```
156716828:files/TG.txt|457239113
156716828:-|457239113?86400
```

### 1.3 Комментарии

- Любая строка, начинающаяся с `# ` (решётка и пробел), полностью игнорируется при чтении.

---

## 2. Блочные файлы (TextBuilder)

Источники блоков:
- `files/tags.txt`
- `files/block1.txt`
- `files/block2.txt`
- `files/block3.txt`
- `files/block4.txt`
- `files/block5.txt`
- `files/links.txt`

Каждый файл содержит набор вариантов, размеченных заголовками:

- `##<числовой_id>` — числовой идентификатор (например, `##1`, `##2`)
- `###<имя>` — именованный идентификатор (например, `###intro`, `###tajikistan`)

Текст до следующего заголовка — содержимое варианта. Пробельные строки внутри варианта сохраняются.

Пример (files/block3.txt):
```
##1
• Интуитивно непонятная боевая система.
• Участники и администраторы, готовые помочь разобраться в ней.
• Свободный отыгрыш и гибкий график дедлайнов.

##2
• Персонажи рождаются полноценными — почти без гринда.
• Баланс классов для командной игры.
• Можно провести собственную партию.

###tajikistan
Welcome to tajikistan
```

Выбор варианта:
- Явный: указать его идентификатор в `groups.txt` (например, `2` или `###tajikistan`).
- Случайный: указать `-` (выберется случайный вариант из списка).

---

## 3. Файлы старых текстов

- `files/text1.txt` … `files/text5.txt` — используются только в старом формате, когда `path == '-'`.

---

## 4. Кэш времени

- `files/dumping.pkl` — файл с кэшем времени последних публикаций по группам (pickle словарь).
  - Ключи — идентификаторы групп (int).
  - Значения — дата/время последней публикации (datetime).
  - Файл создаётся при отсутствии; содержимое не версияруется.

---

## 5. Логи

- `log.txt` — информационные события.
- `error_log.txt` — ошибки и предупреждения.
- Логи находятся в корне проекта; объём/ротация не управляются (можно настроить внешними средствами).

---

## 6. Переменные окружения (.env)

Используется `python-dotenv`:
- `TOKEN` (обязательно) — VK API токен.
- `DEFAULT_WAIT_TIME` (необяз., секунды) — дефолтная задержка между публикациями/проверками.

Пример `.env`:
```
TOKEN=YOUR_VK_API_TOKEN
DEFAULT_WAIT_TIME=43200
```
