# Руководство по запуску (Usage)

## Предусловия

- Python 3.9+
- Доступ к VK API и действительный токен.
- Права на публикацию в целевых сообществах.

## Установка

1) Клонируйте репозиторий и перейдите в каталог проекта.

2) Установите зависимости:
```
pip install -r requirements.txt
```

3) Создайте файл `.env` в корне проекта:
```
TOKEN=YOUR_VK_API_TOKEN
DEFAULT_WAIT_TIME=43200
```
Параметры:
- `TOKEN` (обязательно): токен доступа VK API.
- `DEFAULT_WAIT_TIME` (опционально): дефолтная задержка в секундах (по умолчанию 43200 = 12 часов).

## Подготовка данных

Каталог `files/`:
- `groups.txt` — перечень записей для постинга (новый и старый форматы).
- `tags.txt`, `block1.txt` … `block5.txt`, `links.txt` — источники блоков для TextBuilder.
- `text1.txt` … `text5.txt` — тексты для старого формата (когда путь `-`).
- `dumping.pkl` — кэш времени последнего поста по группам (создаётся автоматически).

Новый формат строки в `files/groups.txt`:
```
groupid:[tags:b1:b2:b3:b4:b5:links:image]|delay
```
Где:
- `tags`, `b1..b5`, `links` — `-` (рандом) или id варианта из соответствующих файлов (`##id` или `###name`).
- `image` — ID изображения (используется как `photo{bot_id}_{image}`).
- `delay` — задержка в формате `1d2h3m4s` (части опциональны).

Примеры:
```
156716828:[-:1:-:###tajikistan:-:-:-:457239113]|3d2h
51153697:[-:-:-:2:-:-:-:457239111]|12h
```

Старый формат:
```
groupid:path|image[?seconds]
```
- Если `path == '-'`, выбирается случайный из `files/text1.txt` … `files/text5.txt`.
- `?seconds` — опциональная задержка (в секундах).

Комментарии:
- Строки, начинающиеся с `# ` (решётка и пробел), игнорируются.

## Запуск

Запуск основного скрипта:
```
python botautomatic.py
```

Поведение:
1) Чтение `files/groups.txt`, пропуск комментариев.
2) Парсинг строк (новый/старый формат).
3) Сборка текста через TextBuilder (новый формат) или загрузка из файла (старый формат).
4) Определение задержки: `|delay` или `?seconds`, иначе `DEFAULT_WAIT_TIME`.
5) Получение типа стены и решение о публикации.
6) Публикация поста и обновление `files/dumping.pkl`.

## Отладка и логи

- Инфолог: `log.txt`
- Ошибки: `error_log.txt`

Рекомендуется следить за файлами логов во время работы и при появлении ошибок в конфигурации, блоках или доступе к VK.

## Тесты и проверка качества

Запуск тестов (включая doctest):
```
pytest
```

Проверка типов:
```
mypy .
```

Проверка docstring (Google style):
```
pydocstyle .
```

## Частые проблемы

1) Ошибка токена
- Убедитесь, что `TOKEN` определён в `.env` и имеет нужные права.

2) Недоступная фотография
- Проверьте корректность `image` и наличие `photo{bot_id}_{image}` у бота.

3) Неверный формат delay
- Используйте `1d2h3m4s` (части опциональны). При неверном формате применится дефолт и будет запись в error_log.
